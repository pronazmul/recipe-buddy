<!DOCTYPE html>
<html>
  <head>
    <title>Search <%=shopData.shopName%></title>
    <link rel="stylesheet" href="./css/toastify.css" />
    <script src="./js/toastify.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <!-- component -->
    <section class="bg-white w-5/6 mx-auto">
      <div class="container px-6 py-10 mx-auto">
        <form
          onsubmit="filterMovie(event)"
          class="relative flex justify-center space-x-3 py-3 mx-11"
        >
          <input
            class="w-[570px] rounded-lg p-2 hover:outline-blue-400 bg-gray-100"
            type="text"
            id="search"
            placeholder="Search By Movie Name"
          />
          <button
            type="submit"
            class="w-32 rounded-lg border bg-blue-700 font-medium text-white hover:bg-blue-800"
          >
            Search
          </button>
        </form>

        <div
          id="movies"
          class="grid grid-cols-1 gap-8 mt-8 md:mt-16 md:grid-cols-2"
        >
          <% shows.forEach(function(show){%>
          <div class="lg:flex">
            <img
              class="object-cover w-full h-56 rounded-lg lg:w-64"
              src="<%=show?.image?.original%>"
              alt="movie thumbnail"
            />

            <div class="flex flex-col justify-between py-6 lg:mx-6">
              <a
                href="#"
                class="text-xl font-semibold text-gray-800 hover:underline"
              >
                <%=show.name%>
              </a>

              <span class="text-sm text-gray-500"><%=show.premiered%></span>
            </div>
          </div>
          <%})%>
        </div>
      </div>
    </section>
  </body>
  <script>
    async function filterMovie(event) {
      event.preventDefault()
      let search = document.getElementById('search').value
      let container = document.getElementById('movies')

      let searchError = Toastify({
        text: 'Something Went Wrong',
        duration: 3000,
      })

      let emptySearch = Toastify({
        text: 'Please provide Your Search Movie!',
        duration: 3000,
      })

      try {
        if (search.length) {
          let query = `https://api.tvmaze.com/search/shows?q=${search}`
          let response = await fetch(query)
          let result = await response.json()
          let data = result.map((shows) => shows.show)

          let attachment = ''

          data.forEach((show) => {
            attachment += `
              <div class='lg:flex'>
                <img
                  class='object-cover w-full h-56 rounded-lg lg:w-64'
                  src=${show?.image?.original}
                  alt='movie thumbnail'
                />

                <div class='flex flex-col justify-between py-6 lg:mx-6'>
                  <a
                    href='#'
                    class='text-xl font-semibold text-gray-800 hover:underline'
                  >
                    ${show.name}
                  </a>

                  <span class='text-sm text-gray-500'>${show.premiered}</span>
                </div>
              </div>`
          })
          container.innerHTML = attachment
          document.getElementById('search').value = ''
        } else {
          emptySearch.showToast()
        }
      } catch (error) {
        searchError.showToast()
      }
    }
  </script>
</html>
